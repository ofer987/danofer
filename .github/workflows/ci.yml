name: Deploy Website

on:
  push:
    branches:
      # TODO: rename back to `master`
      - 'master-svelte'

jobs:
  create-tag:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Increment MINOR Version
        run: |
          MAJOR='0';
          MINOR=$(.github/ruby_scripts/print_latest_minor_version);
          NEXT_MINOR=$(( MINOR+1 ))
          PATCH='0';

          VERSION="${MAJOR}.${NEXT_MINOR}.${PATCH}";
          echo "VERSION=${VERSION}" >> ${GITHUB_ENV}

      - name: Create a New Tag
        run: |
          TAG_NAME="releases/${VERSION}";

          git tag "${TAG_NAME}";
          git push --tags "https://${GITHUB_TOKEN}@github.com/ofer987/danofer.git";

          echo "::notify::${TAG_NAME} has been successfully created"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Failed to Create a New Tag
        if: ${{ failure() }}
        run: |
          echo '::error::Failed to create a new tag'
